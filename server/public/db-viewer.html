<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾½æ¯›çƒæ¯”èµ›æ•°æ®åº“ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: #1890ff;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .nav {
            display: flex;
            background: #f0f0f0;
            border-bottom: 1px solid #ddd;
        }
        
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            border-right: 1px solid #ddd;
            transition: background 0.3s;
        }
        
        .nav-item:hover {
            background: #e6f7ff;
        }
        
        .nav-item.active {
            background: #1890ff;
            color: white;
        }
        
        .content {
            padding: 20px;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            color: #ff4d4f;
            background: #fff2f0;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ffccc7;
        }
        
        .success {
            color: #52c41a;
            background: #f6ffed;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #b7eb8f;
        }
        
        .actions {
            margin-bottom: 20px;
        }
        
        .btn {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #40a9ff;
        }
        
        .btn-danger {
            background: #ff4d4f;
        }
        
        .btn-danger:hover {
            background: #ff7875;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #1890ff;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .match-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .match-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .match-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .match-tab:hover {
            background: #f0f0f0;
        }
        
        .match-tab.active {
            background: #e6f7ff;
            border-bottom-color: #1890ff;
            color: #1890ff;
        }
        
        .match-tab-content {
            display: none;
        }
        
        .match-tab-content.active {
            display: block;
        }
        
        tr:hover {
            background: #f5f5f5 !important;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 12px;
            margin: 0 2px;
        }
        
        .btn-delete {
            background: #ff4d4f;
            color: white;
        }
        
        .btn-delete:hover {
            background: #ff7875;
        }
        
        .btn-view {
            background: #1890ff;
            color: white;
        }
        
        .btn-view:hover {
            background: #40a9ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¸ ç¾½æ¯›çƒæ¯”èµ›æ•°æ®åº“ç®¡ç†</h1>
            <p>å®æ—¶æŸ¥çœ‹å’Œç®¡ç†æ¯”èµ›æ•°æ®</p>
        </div>
        
        <div class="nav">
            <div class="nav-item active" onclick="showTab('overview')">æ¦‚è§ˆ</div>
            <div class="nav-item" onclick="showTab('matches')">æ¯”èµ›</div>
            <div class="nav-item" onclick="showTab('players')">é€‰æ‰‹</div>
        </div>
        
        <div class="content">
            <!-- æ¦‚è§ˆé¡µé¢ -->
            <div id="overview" class="tab-content">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="matchCount">-</div>
                        <div class="stat-label">æ¯”èµ›æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="playerCount">-</div>
                        <div class="stat-label">é€‰æ‰‹æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="gameCount">-</div>
                        <div class="stat-label">æ¯”èµ›åœºæ¬¡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="finishedCount">-</div>
                        <div class="stat-label">å·²å®Œæˆåœºæ¬¡</div>
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn" onclick="refreshData()">åˆ·æ–°æ•°æ®</button>
                    <button class="btn" onclick="addTestData()">æ·»åŠ æµ‹è¯•æ•°æ®</button>
                    <button class="btn btn-danger" onclick="clearData()">æ¸…ç©ºæ•°æ®</button>
                </div>
                
                <div id="message"></div>
            </div>
            
            <!-- å…¶ä»–é¡µé¢ -->
            <div id="matches" class="tab-content" style="display: none;">
                <h2>æ¯”èµ›åˆ—è¡¨</h2>
                <div class="table-container">
                    <table id="matchesTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>æ ‡é¢˜</th>
                                <th>æ—¥æœŸ</th>
                                <th>æ—¶é—´</th>
                                <th>åœ°ç‚¹</th>
                                <th>ç»„ç»‡è€…</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <div id="players" class="tab-content" style="display: none;">
                <h2>é€‰æ‰‹åˆ—è¡¨</h2>
                <div class="table-container">
                    <table id="playersTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>å§“å</th>
                                <th>å¤´åƒ</th>
                                <th>æ¯”èµ›ID</th>
                                <th>åˆ›å»ºæ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            

            
            <!-- æ¯”èµ›è¯¦æƒ…é¡µé¢ -->
            <div id="matchDetails" class="tab-content" style="display: none;">
                <div class="match-header">
                    <button class="btn" onclick="backToMatches()">â† è¿”å›æ¯”èµ›åˆ—è¡¨</button>
                    <h2 id="matchTitle">æ¯”èµ›è¯¦æƒ…</h2>
                </div>
                
                <div class="match-tabs">
                    <div class="match-tab active" onclick="showMatchTab('matchPlayers')">é€‰æ‰‹</div>
                    <div class="match-tab" onclick="showMatchTab('matchGames')">å¯¹é˜µ</div>
                    <div class="match-tab" onclick="showMatchTab('matchStats')">ç»Ÿè®¡</div>
                </div>
                
                <!-- æ¯”èµ›é€‰æ‰‹ -->
                <div id="matchPlayers" class="match-tab-content active">
                    <h3>å‚èµ›é€‰æ‰‹</h3>
                    <div class="table-container">
                        <table id="matchPlayersTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>å§“å</th>
                                    <th>å¤´åƒ</th>
                                    <th>åˆ›å»ºæ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- æ¯”èµ›å¯¹é˜µ -->
                <div id="matchGames" class="match-tab-content" style="display: none;">
                    <h3>æ¯”èµ›å¯¹é˜µ</h3>
                    <div class="table-container">
                        <table id="matchGamesTable">
                            <thead>
                                <tr>
                                    <th>åœºæ¬¡</th>
                                    <th>é˜Ÿä¼1</th>
                                    <th>é˜Ÿä¼2</th>
                                    <th>æ¯”åˆ†</th>
                                    <th>çŠ¶æ€</th>
                                    <th>èƒœè€…</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- æ¯”èµ›ç»Ÿè®¡ -->
                <div id="matchStats" class="match-tab-content" style="display: none;">
                    <h3>é€‰æ‰‹ç»Ÿè®¡</h3>
                    <div class="table-container">
                        <table id="matchStatsTable">
                            <thead>
                                <tr>
                                    <th>æ’å</th>
                                    <th>é€‰æ‰‹</th>
                                    <th>èƒœåœº</th>
                                    <th>è´Ÿåœº</th>
                                    <th>æ€»å¾—åˆ†</th>
                                    <th>æ€»å¤±åˆ†</th>
                                    <th>å‡€èƒœåˆ†</th>
                                    <th>å‚èµ›åœºæ¬¡</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api'
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none'
            })
            
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active')
            })
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).style.display = 'block'
            event.target.classList.add('active')
            
            // åŠ è½½å¯¹åº”æ•°æ®
            loadTabData(tabName)
        }
        
        // åŠ è½½æ ‡ç­¾é¡µæ•°æ®
        async function loadTabData(tabName) {
            try {
                switch(tabName) {
                    case 'overview':
                        await loadOverview()
                        break
                    case 'matches':
                        await loadMatches()
                        break
                    case 'players':
                        await loadPlayers()
                        break
                }
            } catch (error) {
                showMessage('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, 'error')
            }
        }
        
        // åŠ è½½æ¦‚è§ˆæ•°æ®
        async function loadOverview() {
            try {
                console.log('å¼€å§‹åŠ è½½æ¦‚è§ˆæ•°æ®...')
                console.log('API_BASE:', API_BASE)
                
                const [matchesRes, playersRes, gamesRes] = await Promise.all([
                    fetch(`${API_BASE}/matches`),
                    fetch(`${API_BASE}/matches/1/players`),
                    fetch(`${API_BASE}/matches/1/games`)
                ])
                
                console.log('APIå“åº”çŠ¶æ€:', {
                    matches: matchesRes.status,
                    players: playersRes.status,
                    games: gamesRes.status
                })
                
                const matches = await matchesRes.json()
                const players = await playersRes.json()
                const games = await gamesRes.json()
                
                console.log('APIå“åº”æ•°æ®:', {
                    matches: matches,
                    players: players,
                    games: games
                })
                
                document.getElementById('matchCount').textContent = matches.data?.length || 0
                document.getElementById('playerCount').textContent = players.data?.length || 0
                document.getElementById('gameCount').textContent = games.data?.length || 0
                
                const finishedGames = games.data?.filter(g => g.status === 'finished').length || 0
                document.getElementById('finishedCount').textContent = finishedGames
                
                console.log('æ¦‚è§ˆæ•°æ®åŠ è½½å®Œæˆ')
                
            } catch (error) {
                console.error('åŠ è½½æ¦‚è§ˆå¤±è´¥:', error)
                showMessage('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message, 'error')
            }
        }
        
        // åŠ è½½æ¯”èµ›æ•°æ®
        async function loadMatches() {
            try {
                console.log('åŠ è½½æ¯”èµ›æ•°æ®...')
                const response = await fetch(`${API_BASE}/matches`)
                console.log('æ¯”èµ›æ•°æ®å“åº”çŠ¶æ€:', response.status)
                
                const data = await response.json()
                console.log('æ¯”èµ›æ•°æ®:', data)
                
                const tbody = document.querySelector('#matchesTable tbody')
                tbody.innerHTML = ''
                
                if (data.success && data.data) {
                    data.data.forEach(match => {
                        const row = tbody.insertRow()
                        row.innerHTML = `
                            <td>${match.id}</td>
                            <td>${match.title}</td>
                            <td>${match.date}</td>
                            <td>${match.time}</td>
                            <td>${match.location}</td>
                            <td>${match.organizer}</td>
                            <td>${match.status}</td>
                            <td>
                                <button class="btn btn-small btn-view" onclick="event.stopPropagation(); viewMatchDetails(${match.id}, '${match.title}')">æŸ¥çœ‹</button>
                                <button class="btn btn-small btn-delete" onclick="event.stopPropagation(); deleteMatch(${match.id}, '${match.title}')">åˆ é™¤</button>
                            </td>
                        `
                        
                        // æ·»åŠ è¡Œç‚¹å‡»æ•ˆæœï¼ˆé™¤äº†æ“ä½œæŒ‰é’®ï¼‰
                        const cells = row.querySelectorAll('td:not(:last-child)')
                        cells.forEach(cell => {
                            cell.style.cursor = 'pointer'
                            cell.onclick = () => viewMatchDetails(match.id, match.title)
                        })
                        
                        // æ·»åŠ æ‚¬åœæ•ˆæœ
                        row.addEventListener('mouseenter', () => {
                            row.style.backgroundColor = '#f0f0f0'
                        })
                        row.addEventListener('mouseleave', () => {
                            row.style.backgroundColor = ''
                        })
                    })
                    console.log('æ¯”èµ›æ•°æ®åŠ è½½å®Œæˆï¼Œè¡Œæ•°:', data.data.length)
                } else {
                    console.log('æ¯”èµ›æ•°æ®æ ¼å¼é”™è¯¯æˆ–ä¸ºç©º')
                }
            } catch (error) {
                console.error('åŠ è½½æ¯”èµ›æ•°æ®å¤±è´¥:', error)
                showMessage('åŠ è½½æ¯”èµ›æ•°æ®å¤±è´¥: ' + error.message, 'error')
            }
        }
        
        // åŠ è½½é€‰æ‰‹æ•°æ®
        async function loadPlayers() {
            try {
                console.log('åŠ è½½é€‰æ‰‹æ•°æ®...')
                const response = await fetch(`${API_BASE}/matches/1/players`)
                console.log('é€‰æ‰‹æ•°æ®å“åº”çŠ¶æ€:', response.status)
                
                const data = await response.json()
                console.log('é€‰æ‰‹æ•°æ®:', data)
                
                const tbody = document.querySelector('#playersTable tbody')
                tbody.innerHTML = ''
                
                if (data.success && data.data) {
                    data.data.forEach(player => {
                        const row = tbody.insertRow()
                        row.innerHTML = `
                            <td>${player.id}</td>
                            <td>${player.name}</td>
                            <td>${player.avatar}</td>
                            <td>${player.matchId}</td>
                            <td>${new Date(player.created_at).toLocaleString()}</td>
                            <td>
                                <button class="btn btn-small btn-delete" onclick="deletePlayer(${player.matchId}, ${player.id}, '${player.name}')">åˆ é™¤</button>
                            </td>
                        `
                    })
                    console.log('é€‰æ‰‹æ•°æ®åŠ è½½å®Œæˆï¼Œè¡Œæ•°:', data.data.length)
                } else {
                    console.log('é€‰æ‰‹æ•°æ®æ ¼å¼é”™è¯¯æˆ–ä¸ºç©º')
                }
            } catch (error) {
                console.error('åŠ è½½é€‰æ‰‹æ•°æ®å¤±è´¥:', error)
                showMessage('åŠ è½½é€‰æ‰‹æ•°æ®å¤±è´¥: ' + error.message, 'error')
            }
        }
        

        
        // åˆ·æ–°æ•°æ®
        function refreshData() {
            const activeTab = document.querySelector('.nav-item.active').textContent.toLowerCase()
            loadTabData(activeTab)
            showMessage('æ•°æ®å·²åˆ·æ–°', 'success')
        }
        
        // æ·»åŠ æµ‹è¯•æ•°æ®
        async function addTestData() {
            try {
                const response = await fetch('/seed-data', { method: 'POST' })
                const result = await response.json()
                
                if (result.success) {
                    showMessage('æµ‹è¯•æ•°æ®æ·»åŠ æˆåŠŸ', 'success')
                    refreshData()
                } else {
                    showMessage('æ·»åŠ æµ‹è¯•æ•°æ®å¤±è´¥: ' + result.message, 'error')
                }
            } catch (error) {
                showMessage('æ·»åŠ æµ‹è¯•æ•°æ®å¤±è´¥: ' + error.message, 'error')
            }
        }
        
        // æ¸…ç©ºæ•°æ®
        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                showMessage('æ¸…ç©ºæ•°æ®åŠŸèƒ½å¾…å®ç°', 'error')
            }
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = 'success') {
            const messageDiv = document.getElementById('message')
            messageDiv.className = type
            messageDiv.textContent = text
            
            setTimeout(() => {
                messageDiv.textContent = ''
                messageDiv.className = ''
            }, 3000)
        }
        
        // å½“å‰é€‰ä¸­çš„æ¯”èµ›ID
        let currentMatchId = null
        
        // æŸ¥çœ‹æ¯”èµ›è¯¦æƒ…
        function viewMatchDetails(matchId, matchTitle) {
            console.log('æŸ¥çœ‹æ¯”èµ›è¯¦æƒ…:', matchId, matchTitle)
            currentMatchId = matchId
            
            // éšè—æ‰€æœ‰ä¸»æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none'
            })
            
            // æ˜¾ç¤ºæ¯”èµ›è¯¦æƒ…é¡µé¢
            document.getElementById('matchDetails').style.display = 'block'
            document.getElementById('matchTitle').textContent = matchTitle
            
            // åŠ è½½æ¯”èµ›è¯¦æƒ…æ•°æ®
            loadMatchDetails(matchId)
        }
        
        // è¿”å›æ¯”èµ›åˆ—è¡¨
        function backToMatches() {
            document.getElementById('matchDetails').style.display = 'none'
            document.getElementById('matches').style.display = 'block'
            currentMatchId = null
        }
        
        // åˆ‡æ¢æ¯”èµ›è¯¦æƒ…æ ‡ç­¾é¡µ
        function showMatchTab(tabName) {
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.match-tab').forEach(tab => {
                tab.classList.remove('active')
            })
            document.querySelectorAll('.match-tab-content').forEach(content => {
                content.classList.remove('active')
                content.style.display = 'none'
            })
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾é¡µ
            event.target.classList.add('active')
            const content = document.getElementById(tabName)
            content.classList.add('active')
            content.style.display = 'block'
        }
        
        // åŠ è½½æ¯”èµ›è¯¦æƒ…æ•°æ®
        async function loadMatchDetails(matchId) {
            try {
                console.log('åŠ è½½æ¯”èµ›è¯¦æƒ…æ•°æ®:', matchId)
                
                // åŠ è½½é€‰æ‰‹æ•°æ®
                await loadMatchPlayers(matchId)
                
                // åŠ è½½å¯¹é˜µæ•°æ®
                await loadMatchGames(matchId)
                
                // åŠ è½½ç»Ÿè®¡æ•°æ®
                await loadMatchStatsData(matchId)
                
            } catch (error) {
                console.error('åŠ è½½æ¯”èµ›è¯¦æƒ…å¤±è´¥:', error)
                showMessage('åŠ è½½æ¯”èµ›è¯¦æƒ…å¤±è´¥: ' + error.message, 'error')
            }
        }
        
        // åŠ è½½æ¯”èµ›é€‰æ‰‹æ•°æ®
        async function loadMatchPlayers(matchId) {
            try {
                const response = await fetch(`${API_BASE}/matches/${matchId}/players`)
                const data = await response.json()
                
                const tbody = document.querySelector('#matchPlayersTable tbody')
                tbody.innerHTML = ''
                
                if (data.success && data.data) {
                    data.data.forEach(player => {
                        const row = tbody.insertRow()
                        row.innerHTML = `
                            <td>${player.id}</td>
                            <td>${player.name}</td>
                            <td>${player.avatar}</td>
                            <td>${new Date(player.created_at).toLocaleString()}</td>
                            <td>
                                <button class="btn btn-small btn-delete" onclick="deletePlayerFromMatch(${matchId}, ${player.id}, '${player.name}')">åˆ é™¤</button>
                            </td>
                        `
                    })
                }
            } catch (error) {
                console.error('åŠ è½½æ¯”èµ›é€‰æ‰‹å¤±è´¥:', error)
            }
        }
        
        // åŠ è½½æ¯”èµ›å¯¹é˜µæ•°æ®
        async function loadMatchGames(matchId) {
            try {
                const response = await fetch(`${API_BASE}/matches/${matchId}/games`)
                const data = await response.json()
                
                const tbody = document.querySelector('#matchGamesTable tbody')
                tbody.innerHTML = ''
                
                if (data.success && data.data) {
                    data.data.forEach(game => {
                        const team1 = game.team1?.map(p => p.name).join('-') || 'æœªçŸ¥'
                        const team2 = game.team2?.map(p => p.name).join('-') || 'æœªçŸ¥'
                        
                        const row = tbody.insertRow()
                        row.innerHTML = `
                            <td>${game.roundName}</td>
                            <td>${team1}</td>
                            <td>${team2}</td>
                            <td>${game.score1}:${game.score2}</td>
                            <td>${game.status === 'finished' ? 'å·²å®Œæˆ' : 'æœªå¼€å§‹'}</td>
                            <td>${game.winner ? `é˜Ÿä¼${game.winner}` : '-'}</td>
                        `
                    })
                }
            } catch (error) {
                console.error('åŠ è½½æ¯”èµ›å¯¹é˜µå¤±è´¥:', error)
            }
        }
        
        // åŠ è½½æ¯”èµ›ç»Ÿè®¡æ•°æ®
        async function loadMatchStatsData(matchId) {
            try {
                const response = await fetch(`${API_BASE}/matches/${matchId}/results`)
                const data = await response.json()
                
                const tbody = document.querySelector('#matchStatsTable tbody')
                tbody.innerHTML = ''
                
                if (data.success && data.data) {
                    data.data.forEach((stat, index) => {
                        const row = tbody.insertRow()
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${stat.name} ${stat.avatar}</td>
                            <td>${stat.wins}</td>
                            <td>${stat.losses}</td>
                            <td>${stat.totalScore}</td>
                            <td>${stat.opponentScore}</td>
                            <td>${stat.scoreDiff > 0 ? '+' : ''}${stat.scoreDiff}</td>
                            <td>${stat.gamesPlayed}</td>
                        `
                        
                        // æ·»åŠ æ’åæ ·å¼
                        if (index === 0) {
                            row.style.backgroundColor = '#fff7e6'
                        } else if (index === 1) {
                            row.style.backgroundColor = '#f6f6f6'
                        } else if (index === 2) {
                            row.style.backgroundColor = '#fff2e6'
                        }
                    })
                }
            } catch (error) {
                console.error('åŠ è½½æ¯”èµ›ç»Ÿè®¡å¤±è´¥:', error)
            }
        }
        
        // åˆ é™¤æ¯”èµ›
        async function deleteMatch(matchId, matchTitle) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤æ¯”èµ› "${matchTitle}" å—ï¼Ÿ\n\nåˆ é™¤æ¯”èµ›å°†åŒæ—¶åˆ é™¤è¯¥æ¯”èµ›çš„æ‰€æœ‰é€‰æ‰‹ã€å¯¹é˜µå’Œç»Ÿè®¡æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return
            }
            
            try {
                console.log('åˆ é™¤æ¯”èµ›:', matchId, matchTitle)
                const response = await fetch(`${API_BASE}/matches/${matchId}`, {
                    method: 'DELETE'
                })
                
                if (response.ok) {
                    const result = await response.json()
                    showMessage(`æ¯”èµ› "${matchTitle}" åˆ é™¤æˆåŠŸ`, 'success')
                    
                    // åˆ·æ–°æ•°æ®
                    await loadMatches()
                    await loadOverview()
                } else {
                    const error = await response.json()
                    showMessage(`åˆ é™¤æ¯”èµ›å¤±è´¥: ${error.error?.message || 'æœªçŸ¥é”™è¯¯'}`, 'error')
                }
            } catch (error) {
                console.error('åˆ é™¤æ¯”èµ›å¤±è´¥:', error)
                showMessage(`åˆ é™¤æ¯”èµ›å¤±è´¥: ${error.message}`, 'error')
            }
        }
        
        // åˆ é™¤é€‰æ‰‹
        async function deletePlayer(matchId, playerId, playerName) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰æ‰‹ "${playerName}" å—ï¼Ÿ\n\nåˆ é™¤é€‰æ‰‹å°†åŒæ—¶åˆ é™¤è¯¥é€‰æ‰‹çš„æ‰€æœ‰å¯¹é˜µå’Œç»Ÿè®¡æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return
            }
            
            try {
                console.log('åˆ é™¤é€‰æ‰‹:', matchId, playerId, playerName)
                const response = await fetch(`${API_BASE}/matches/${matchId}/players/${playerId}`, {
                    method: 'DELETE'
                })
                
                if (response.ok) {
                    const result = await response.json()
                    showMessage(`é€‰æ‰‹ "${playerName}" åˆ é™¤æˆåŠŸ`, 'success')
                    
                    // åˆ·æ–°æ•°æ®
                    await loadPlayers()
                    await loadOverview()
                } else {
                    const error = await response.json()
                    showMessage(`åˆ é™¤é€‰æ‰‹å¤±è´¥: ${error.error?.message || 'æœªçŸ¥é”™è¯¯'}`, 'error')
                }
            } catch (error) {
                console.error('åˆ é™¤é€‰æ‰‹å¤±è´¥:', error)
                showMessage(`åˆ é™¤é€‰æ‰‹å¤±è´¥: ${error.message}`, 'error')
            }
        }
        
        // ä»æ¯”èµ›è¯¦æƒ…é¡µé¢åˆ é™¤é€‰æ‰‹
        async function deletePlayerFromMatch(matchId, playerId, playerName) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰æ‰‹ "${playerName}" å—ï¼Ÿ\n\nåˆ é™¤é€‰æ‰‹å°†åŒæ—¶åˆ é™¤è¯¥é€‰æ‰‹çš„æ‰€æœ‰å¯¹é˜µå’Œç»Ÿè®¡æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return
            }
            
            try {
                console.log('ä»æ¯”èµ›è¯¦æƒ…åˆ é™¤é€‰æ‰‹:', matchId, playerId, playerName)
                const response = await fetch(`${API_BASE}/matches/${matchId}/players/${playerId}`, {
                    method: 'DELETE'
                })
                
                if (response.ok) {
                    const result = await response.json()
                    showMessage(`é€‰æ‰‹ "${playerName}" åˆ é™¤æˆåŠŸ`, 'success')
                    
                    // åˆ·æ–°æ¯”èµ›è¯¦æƒ…æ•°æ®
                    await loadMatchDetails(matchId)
                } else {
                    const error = await response.json()
                    showMessage(`åˆ é™¤é€‰æ‰‹å¤±è´¥: ${error.error?.message || 'æœªçŸ¥é”™è¯¯'}`, 'error')
                }
            } catch (error) {
                console.error('åˆ é™¤é€‰æ‰‹å¤±è´¥:', error)
                showMessage(`åˆ é™¤é€‰æ‰‹å¤±è´¥: ${error.message}`, 'error')
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...')
            loadOverview()
        })
        
        // ä¹Ÿåœ¨window.onloadæ—¶å°è¯•åŠ è½½
        window.onload = function() {
            console.log('window.onload è§¦å‘ï¼Œå°è¯•åŠ è½½æ•°æ®...')
            setTimeout(() => {
                loadOverview()
            }, 1000)
        }
    </script>
</body>
</html>